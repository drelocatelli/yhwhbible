<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="style.css" type="text/css" rel="stylesheet" />
        <title>Busca Salmos - Tehilim Biblia de Yhwh</title>
    </head>

    <body>
        <div class="form-group">
            <h2 style="font-family:sans-serif; padding:0; margin:0;">Salmos - Tehilim (Yhwh)</h2><br>
            <form name="getsalmo" method="get">

                <input name="salmo" type="number" min="1" max="150" class="form-control">
                <button type="submit" class="btn btn-default">Buscar</button>
                <button type="button" name='sortear' class="btn btn-default">Sortear</button>

            </form>

            <append></append>

            <div id='salmo'>
                <titulo>Tehilim 1</titulo> 
                <br>
                <salmo>
                    Como é feliz aquele que não segue o conselho dos ímpios, não imita a conduta dos pecadores, nem se assenta na roda dos zombadores! Ao contrário, sua satisfação está na lei do criador, e nessa lei medita dia e noite. É como árvore plantada à beira de águas correntes: Dá fruto no tempo certo e suas folhas não murcham. Tudo o que ele faz prospera!Não é o caso dos ímpios! São como palha que o vento leva.Por isso os ímpios não resistirão no julgamento, nem os pecadores na comunidade dos justos.Pois o criador aprova o caminho dos justos, mas o caminho dos ímpios leva à destruição!
                </salmo>
                <br><br>
                <center>
                    <button type="button" class='btn btn-default' name='copy'>Copiar</button>
                </center>
            </div>
        </div>

       

    </body>

</html>

<script>

    let formulario = document.querySelector('form[name=getsalmo]')
    let salmo = formulario.querySelector('input[name=salmo]')
    let salmoBtn = formulario.querySelector('button')
    let sorteioBtn = formulario.querySelector('button[name=sortear]')

    let salmotitle = document.querySelector('titulo')
    let salmoler = document.querySelector('salmo')
    let copyBtn = document.querySelector('button[name=copy]')
    var error = false
 
    salmo.value = '1'
    salmo.ondblclick = function(){
        salmo.select()
    }

    if(!error){
        copyBtn.style.display = 'block'
    }else{
        copyBtn.style.display = 'none'
    }

    copyBtn.onclick = function(){

        let textarea = document.createElement('textarea')
        textarea.value = `${salmotitle.innerText}
${salmoler.innerText}`
        document.querySelector('append').appendChild(textarea)

        textarea.select()
        document.execCommand('Copy')
        textarea.style.display = 'none'
        
    }

    var prmstr = window.location.search.substr(1);
    salmoNum = prmstr.replace('salmo=','')
    salmo.value = salmoNum

    function getSalmo(){
        salmotitle.innerHTML = 'Tehilim ?'
        salmoler.innerHTML = 'Carregando...'
        setTimeout(function(){
            
        let request = new Request(`https://www.abibliadigital.com.br/api/verses/nvi/sl/${salmo.value}`, {
           method: 'GET',
         });

         fetch(request).then(function(response) { return response.text() }).then(function(response){
           var response = JSON.parse(response)

           salmotitle.innerHTML = `Tehilim ${salmo.value}` 

           if(response.msg){
               error = true
                salmoler.innerHTML = 'Ocorreu um erro ao carregar, tente novamente mais tarde.'
                return
           }else{
               error = false
           }

           response = response.verses


           var leitura = ''
            for(let i = 0; i <= response.length; i++){
                leitura += ' '+response[i].text

                leitura = leitura.replace('Deus', 'YHWH').replace('Senhor', 'criador').replace('puro','limpo').replace('misericórdia', 'benevolência').replace(',]', ']').replace('"','ˮ').replace('\'','"').replace('cruz','madeiro').replace('Cruz', 'madeiro').replace('amém', 'assim seja').replace('batismo', 'imersão').replace('glória', 'grandeza').replace('vitória','conquista').replace('misericordioso','benevolente').replace('.','. ').replace('!','! ').replace('Amém','Assim seja').replace('?', '? ').replace('pausa','').replace('Pausa', '').replace('escudo protetor', 'escudo e couraça')

                salmoler.innerHTML = leitura
                salmoler.value = leitura

            }


         });
        },500)
    }

    function sortearSalmo(){
        let num = Math.floor(Math.random() * 151)
        if(num == 0){
            num = 1
        }
        salmo.value = num
        salmoBtn.click()
    }

    if(salmoNum == ''){
        salmo.value = '1'
    }

    getSalmo()

    salmoBtn.onclick = function(){
        getSalmo()
    }

    sorteioBtn.onclick = function(){
        sortearSalmo()
    }

    formulario.onsubmit = function(e){
        // e.preventDefault()

        // let url = new URL(`${window.location.href}?salmo=${salmo.value}`)
        // let params = new URLSearchParams(url.search);

        // url.href = `${url.href}`

        // history.pushState({}, null, url.href);

        getSalmo()
        

    }



</script>