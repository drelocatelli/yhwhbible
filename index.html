<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="style.css" type="text/css" rel="stylesheet" />
        <title>Busca Salmos - Tehilim Biblia de Yhwh</title>
    </head>

    <body>
        <div class="form-group">
            <h2 style="font-family:sans-serif; padding:0; margin:0;">Salmos - Tehilim (Yhwh)</h2><br>
            <form name="getsalmo" method="get">

                <input name="salmo" type="number" min="1" max="150" class="form-control">
                <button type="submit" class="btn btn-default">Buscar</button>

            </form>

            <div id='salmo' style="padding-top: 100px; font-family: serif; ">
                <titulo>Tehilim 1</titulo> 
                <br>
                <salmo>
                    Carregando...
                </salmo>
            </div>
        </div>

       

    </body>

</html>

<script>

    let formulario = document.querySelector('form[name=getsalmo]')
    let salmo = formulario.querySelector('input[name=salmo]')
    let salmoBtn = formulario.querySelector('button')

    let salmotitle = document.querySelector('titulo')
    let salmoler = document.querySelector('salmo')
 
    salmo.value = '1'
    salmoBtn.click()

    var prmstr = window.location.search.substr(1);
    salmoNum = prmstr.replace('salmo=','')
    salmo.value = salmoNum

    function getSalmo(){
        let request = new Request(`https://www.abibliadigital.com.br/api/verses/nvi/sl/${salmo.value}`, {
           method: 'GET',
         });

         fetch(request).then(function(response) { return response.text() }).then(function(response){
           var response = JSON.parse(response)

           salmotitle.innerHTML = `Tehilim ${salmo.value}` 

           if(response.msg){
                salmoler.innerHTML = 'Ocorreu um erro ao carregar, tente novamente mais tarde.'
                return
           }

           response = response.verses


           var leitura = ''
            for(let i = 0; i <= response.length; i++){
                leitura += response[i].text

                leitura = leitura.replace('Deus', 'Yhwh').replace('Senhor', 'criador').replace('puro','limpo').replace('misericórdia', 'benevolência').replace(',]', ']').replace('"','ˮ').replace('\'','"').replace('cruz','madeiro').replace('Cruz', 'madeiro').replace('amém', 'assim seja').replace('batismo', 'imersão').replace('glória', 'grandeza').replace('vitória','conquista').replace('misericordioso','benevolente').replace('.','. ')

                salmoler.innerHTML = leitura

            }


         });
    }

    if(salmoNum == ''){
        salmo.value = '1'
    }
    getSalmo()

    formulario.onsubmit = function(e){
        // e.preventDefault()

        // let url = new URL(`${window.location.href}?salmo=${salmo.value}`)
        // let params = new URLSearchParams(url.search);

        // url.href = `${url.href}`

        // history.pushState({}, null, url.href);

        getSalmo()
        

    }



</script>